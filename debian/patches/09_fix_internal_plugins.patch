Description: Fix check for lua libs.
 The internal plugins Makefile is too strict on the pkgconfig check for
 lua config, so I made the hyphen optional and added a number to make
 a possible mismatch more unlikely.
 Also the lua plugin is not looking at the same directory for radare.lua
 as the installation says.
 The Perl plugin links to libncurses for no good reason.
Author: David Mart√≠nez Moreno <ender@debian.org>
Forwarded: no
Last-Update: 2013-12-27

--- a/libr/lang/p/Makefile
+++ b/libr/lang/p/Makefile
@@ -1,11 +1,11 @@
 BINDEPS=foo
 include ../../config.mk
 
-CFLAGS+=-I../../include -Wall -DPREFIX=\"${PREFIX}\"
+CFLAGS+=-I../../include -Wall -DLIBDIR=\"${LIBDIR}\"
 ifeq ($(OSTYPE),darwin)
 CFLAGS+=-undefined dynamic_lookup
 endif
-LUAPKG=$(shell pkg-config --list-all|awk '/lua-/{print $$1;}')
+LUAPKG=$(shell pkg-config --list-all|awk '/lua-?[0-9]/{print $$1};')
 ifneq (${LUAPKG},)
 CFLAGS+=$(shell pkg-config --cflags ${LUAPKG})
 LUA_LDFLAGS+=$(shell pkg-config --libs ${LUAPKG})
@@ -57,7 +57,7 @@
 	-${CC} ${CFLAGS} -I/usr/lib/perl/5.10/CORE/ \
 		-fPIC ${LDFLAGS_LIB} -o lang_perl.${EXT_SO} perl.c ${LDFLAGS_LINKPATH}.. \
 		`perl -MExtUtils::Embed -e ccopts | sed -e 's/-arch [^\s]* //g'` \
-		`perl -MExtUtils::Embed -e ldopts | sed -e 's/-arch [^\s]* //g'` -lncurses
+		`perl -MExtUtils::Embed -e ldopts | sed -e 's/-arch [^\s]* //g'`
 
 mrproper clean:
 	-rm -f *.${EXT_SO} *.${EXT_AR} *.o
--- a/libr/lang/p/lua.c
+++ b/libr/lang/p/lua.c
@@ -7,8 +7,6 @@
 #include <lualib.h>
 #include <lauxlib.h>
 
-#define LIBDIR PREFIX"/lib"
-
 static lua_State *L;
 static RCore* core = NULL;
 static int lua_run(RLang *lang, const char *code, int len);
