# config.mk.tail

ifneq (${BINDEPS},)
include ../../../config-user.mk
include ../../../global.mk
include ../../../mk/${COMPILER}.mk
else
-include ../../config-user.mk
-include ../../global.mk
-include ../../mk/${COMPILER}.mk

-include ../../../config-user.mk
-include ../../../global.mk
-include ../../../mk/${COMPILER}.mk
endif


CFLAGS+=-DUSE_RIO=${USE_RIO}
CFLAGS+=${CFLAGS_APPEND}

ifeq ($(WITHPIC),1)
LDFLAGS+=$(subst r_,-lr_,$(DEPS))
LDFLAGS+=$(subst r_,-L../,$(DEPS))
LDFLAGS+=$(subst r_,-lr_,$(BINDEPS))
LDFLAGS+=$(subst r_,-L../../,$(BINDEPS))
ifeq ($(OSTYPE),darwin)
BOO=-L../../
else
BOO=-Wl,-R../../
endif
LDFLAGS+=$(subst r_,${BOO},$(BINDEPS))
CFLAGS+=${PIC_CFLAGS}
LDFLAGS+=${PIC_CFLAGS}
else
# TODO: is there somebody brave enought to replace this perl oneliner?
ifneq ($(DEPS), )
LDFLAGS+=`echo "${DEPS} " | perl -ne 's,r_([^ ]*),../$$1/libr_$$1.a,g; print'`
endif
ifneq ($(BINDEPS), )
LDFLAGS+=`echo "${BINDEPS} " | perl -ne 's,r_([^ ]*),../../$$1/libr_$$1.a,g; print'`
endif
endif

# Compiler: see mk/gcc.mk
# CC CFLAGS CC_LIB CC_AR LINK

# Debug
CFLAGS+=-g -Wall

# XXX do it in configure stage
OSTYPE?=gnulinux
# Output
ifeq (${OSTYPE},windows)
CFLAGS+=-D__WINDOWS__=1
EXT_AR=lib
EXT_SO=dll
EXT_EXE=.exe
TH_LIBS=
endif
ifeq (${OSTYPE},gnulinux)
CFLAGS+=-D__UNIX__=1
EXT_AR=a
EXT_SO=so
EXT_EXE=
TH_LIBS=-lpthread
endif
ifeq (${OSTYPE},darwin)
CFLAGS+=-D__UNIX__=1
EXT_AR=a
EXT_SO=dylib
EXT_EXE=
TH_LIBS=-lpthread
endif

LIB=lib${NAME}
LIBAR=${LIB}.${EXT_AR}
LIBSO=${LIB}.${EXT_SO}
